<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>福州市古厝文化信息检索与展示系统</title>
    <link rel="icon" type="image/x-icon" href="/images/title.ico" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="/css/second.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
    <link rel="stylesheet" href="/css/search.css" />
    <script type="text/javascript" src="/js/sweetalert-dev.js"></script>
    <script type="text/javascript"
        src="http://api.map.baidu.com/api?v=2.0&ak=2GVVoVth63ABPvY68rX4dek93chHmGjT"></script>
    <script type="text/javascript"
        src="http://api.map.baidu.com/library/SearchControl/1.4/src/SearchControl_min.js"></script>
    <script type="text/javascript"
        src="http://api.map.baidu.com/library/DistanceTool/1.2/src/DistanceTool_min.js"></script>
    <script type="text/javascript"
        src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/measure.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript"
        src="//api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
    <script type="text/javascript" src="/js/MarkerClusterer.js"></script>
    <style>
        div.BMapLib_Drawing.BMap_noprint.anchorTL {
            display: block;
        }
    </style>
</head>

<body>
    <iframe src="navbar.html" style="display:block;" height="126px" width="100%" frameborder="0"></iframe>
    <iframe src="navbar2.html" style="display:block;float: left;margin-right: 0.15%;" width="11.5%" height="80%"
        frameborder="0"></iframe>
    <div class="container" id="allmap" style="width: 88.35%;">
        <!-- 第二页内容区 -->
    </div>
    <hr>
    <!-- 底部 -->
    <div id="foot">
        <span id="span2">2017级地理信息科学本科团支部</span>
    </div>
</body>

<script type="text/javascript" src="/js/map.js"></script>
<script type="text/javascript">
    // 导航控件
    map.addControl(
        new BMap.NavigationControl({
            anchor: BMAP_ANCHOR_TOP_RIGHT
        })
    );
    // 地图类型控件
    map.addControl(new BMap.MapTypeControl({
        anchor: BMAP_ANCHOR_TOP_LEFT,
        MapTypeControl: BMAP_MAPTYPE_CONTROL_MAP,
        mapTypes: [
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP,
        ]
    }));

    // 城市列表控件
    map.addControl(new BMap.CityListControl({
        anchor: BMAP_ANCHOR_TOP_LEFT,
        offset: new BMap.Size(100, 9),
    }));

    //添加全景控件
    var opts1 = {
        indoorSceneSwitchControl: true,
        albumsControl: true,
        linksControl: false
    };
    var stCtrl = new BMap.PanoramaControl("allmap", opts1);
    stCtrl.setOffset(new BMap.Size(25, 200));
    map.addControl(stCtrl);

    //测量工具
    var myDistanceToolObject = new BMapLib.DistanceTool(map, { lineStroke: 2 });
    function measuretool() {
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(180, 10);
    }
    measuretool.prototype = new BMap.Control();
    measuretool.prototype.initialize = function (map) {
        var div = document.createElement("div");
        div.className = "btn-group"
        div.id = "measuretool"
        div.innerHTML = `<button type="button" class="btn btn-primary btn-xs dropdown-toggle" 
			    data-toggle="dropdown">测量工具<span class="caret"></span>
            </button>
            <ul id="ul" class="dropdown-menu" role="menu" style="min-width:10px;">
			    <li><a href = "javascript:void(0)" onclick="measure1()">距离测量</a></li>
			    <li class="divider"></li>
			    <li><a href = "javascript:void(0)" onclick="measure2()">面积测量</a></li>
			    <li class="divider"></li>
			    <li><a href = "javascript:void(0)" onclick="measure3()">清除覆盖</a></li>
            </ul>`
        map.getContainer().appendChild(div);
        //返回DOM
        return div;
    };

    //创建控件实例
    var staticsCtrl = new measuretool();
    //添加到地图当中
    map.addControl(staticsCtrl);
    measure1 = function () {
        myDistanceToolObject.open();
    }
    measure2 = function () {
        var a = document.getElementsByClassName("BMapLib_Drawing BMap_noprint anchorTL")[0]
        a.style.display = "block";
        document.getElementById("tool").style.display = "block";
    }
    measure3 = function () {
        map.clearOverlays();
    }
    var overlays = [];
    var overlaycomplete = function (e) {
        overlays.push(e.overlay);
    };
    var styleOptions = {
        strokeColor: "red",    //边线颜色。
        fillColor: "white",      //填充颜色。当参数为空时，圆形将没有填充效果。
        strokeWeight: 3,       //边线的宽度，以像素为单位。
        strokeOpacity: 0.8,	   //边线透明度，取值范围0 - 1。
        fillOpacity: 0.6,      //填充的透明度，取值范围0 - 1。
        strokeStyle: 'solid', //边线的样式，solid或dashed。
        a: true,

    }
    //实例化鼠标绘制工具
    var drawingManager = new BMapLib.DrawingManager(map, {
        isOpen: false, //是否开启绘制模式
        enableDrawingTool: true, //是否显示工具栏
        drawingToolOptions: {
            anchor: BMAP_ANCHOR_TOP_LEFT, //位置
            offset: new BMap.Size(10, 40), //偏离值
            drawingModes: [BMAP_DRAWING_POLYGON, BMAP_DRAWING_RECTANGLE, BMAP_DRAWING_CIRCLE]
        },
        circleOptions: styleOptions, //圆的样式
        polylineOptions: styleOptions, //线的样式
        polygonOptions: styleOptions, //多边形的样式
        rectangleOptions: styleOptions //矩形的样式
    });
    drawingManager.enableCalculate();
    //添加鼠标绘制工具监听事件，用于获取绘制结果
    drawingManager.addEventListener('overlaycomplete', overlaycomplete);
    document.getElementsByClassName("BMapLib_Drawing BMap_noprint anchorTL")[0].style.display = "none";
    /* document.getElementsByClassName("btn-group BMap_noprint anchorTL")[0].style.zIndex = "10000"; */

    function tool() {
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(270, 50);
    }
    tool.prototype = new BMap.Control();
    tool.prototype.initialize = function (map) {
        var div = document.createElement("a");
        div.href = "javascript:void(0)"
        div.id = "tool"
        div.style.display = "none"
        div.style.textDecoration = "none"
        div.style.fontSize = "25px"
        div.className = "glyphicon glyphicon-chevron-up";
        div.onclick = function () {
            var a = document.getElementsByClassName("BMapLib_Drawing BMap_noprint anchorTL")[0]
            a.style.display = "none";
            document.getElementById("tool").style.display = "none";
        }
        map.getContainer().appendChild(div);
        return div;
    };
    var myZoomCtrl = new tool();
    map.addControl(myZoomCtrl);

    function searchBox() {
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(10, 40);
    }
    searchBox.prototype = new BMap.Control();
    searchBox.prototype.initialize = function (map) {
        var div = document.createElement("div");
        div.id = "searchBox"
        div.style.display = "none"
        div.style.width = "350px";
        map.getContainer().appendChild(div);
        return div;
    };
    var myCtrl = new searchBox();
    map.addControl(myCtrl);
    //开源API工具控件

    function tool2() {
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(370, 50);
    }
    tool2.prototype = new BMap.Control();
    tool2.prototype.initialize = function (map) {
        var div = document.createElement("a");
        div.href = "javascript:void(0)"
        div.id = "tool2"
        div.style.display = "none"
        div.style.textDecoration = "none"
        div.style.fontSize = "25px"
        div.className = "glyphicon glyphicon-chevron-up";
        div.onclick = function () {
            document.getElementById("searchBox").style.display = "none"
            document.getElementById("tool2").style.display = "none";
        }
        map.getContainer().appendChild(div);
        return div;
    };
    var myZoomCtrl = new tool2();
    map.addControl(myZoomCtrl);

    //创建检索控件
    var searchControl = new BMapLib.SearchControl({
        container: "searchBox",//存放控件的容器
        map: map, //关联地图对象
        type: LOCAL_SEARCH, //检索类型
    });

    //测量工具
    function searchtool() {
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(260, 10);
    }
    searchtool.prototype = new BMap.Control();
    searchtool.prototype.initialize = function (map) {
        var div = document.createElement("div");
        div.className = "btn-group"
        div.innerHTML = `<button type="button" class="btn btn-primary btn-xs dropdown-toggle" 
			    data-toggle="dropdown">搜索工具<span class="caret"></span>
            </button>
            <ul id="ul" class="dropdown-menu" role="menu" style="min-width:10px;">
			    <li><a href = "javascript:void(0)" onclick="search1()">本地检索</a></li>
			    <li class="divider"></li>
			    <li><a href = "javascript:void(0)" onclick="search2()">公交检索</a></li>
			    <li class="divider"></li>
			    <li><a href = "javascript:void(0)" onclick="search3()">驾车检索</a></li>
            </ul>`
        map.getContainer().appendChild(div);
        //返回DOM
        return div;
    };
    var staticsCtrl = new searchtool();
    map.addControl(staticsCtrl);

    search1 = function () {
        document.getElementById("searchBox").style.display = "block"
        document.getElementById("tool2").style.display = "block"
        searchControl.setType(LOCAL_SEARCH);
    }
    search2 = function () {
        document.getElementById("searchBox").style.display = "block"
        document.getElementById("tool2").style.display = "block"
        searchControl.setType(TRANSIT_ROUTE);
    }
    search3 = function () {
        document.getElementById("searchBox").style.display = "block"
        document.getElementById("tool2").style.display = "block"
        searchControl.setType(DRIVING_ROUTE);
    }
</script>

</html>