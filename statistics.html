<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>福州市古厝文化信息检索与展示系统</title>
    <link rel="icon" type="image/x-icon" href="/images/title.ico" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="/css/second.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <script type="text/javascript" src="/js/sweetalert-dev.js"></script>
    <script type="text/javascript"
        src="http://api.map.baidu.com/api?v=2.0&ak=2GVVoVth63ABPvY68rX4dek93chHmGjT"></script>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/echarts/4.4.0-rc.1/echarts-en.common.js"></script>
    <script type="text/javascript"
        src="//api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
    <script type="text/javascript" src="/js/MarkerClusterer.js"></script>
    <style type="text/css">
        #datas {
            display: none;
        }

        #msg {
            margin: 0 auto;
            text-align: left;
        }

        .sweetAlert {
            width: 80em;
            margin: 0 auto;
            left: 0;
            right: 0;
        }
    </style>
</head>

<body>
    <iframe src="navbar.html" style="display:block;width: 100%;height: 12.5%;" frameborder="0"></iframe>
    <iframe src="navbar2.html" style="display:block;float:left;width: 11.5%;height: 87.5%;" frameborder="0"></iframe>
    <div class="container" id="allmap" style="width: 73.35%;float: left;">
        <!-- 第二页内容区 -->
    </div>
    <div id="tab" style="width: 15%;height:87.5%;float:left;"></div>
</body>

<script type="text/javascript" src="/js/map.js"></script>
<script>
    function delRepeat(arr) {
        // 定义一个新数组
        var newArr = [];
        // 遍历传进来的数组
        for (var i = 0; i < arr.length; i++) {
            // 如果newArr里没有arr[i]
            if (newArr.indexOf(arr[i]) == -1) {
                // 把arr[i]传进新数组
                newArr.push(arr[i]);
            }
        }
        // 返回新数组
        return newArr;
    }
    function removeEmptyEle(arr) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i] == null) {
                arr.splice(i, 1);
                i = i - 1; // i - 1 ,因为空元素在数组下标 2 位置，删除空之后，后面的元素要向前补位，
                // 这样才能真正去掉空元素,觉得这句可以删掉的连续为空试试，然后思考其中逻辑
            }
        }
        return arr;
    };
    arrayLookup = function (data, key, value, targetKey) {
        var targetValue = "";
        for (var i = 0; i < data.length; i++) {
            if (data[i][key] == value) {
                targetValue = data[i][targetKey];
                break;
            }
        }
        return targetValue;
    }
</script>
<script type="text/javascript">
    document.getElementById("t1").style.display = "none"
    document.getElementById("t2").style.display = "none"
    //添加坐标自定义显示控件
    map.addEventListener("mousemove", function (e) {
        var jing_du_value = e.point.lng;
        var wei_du_value = e.point.lat;
        var cengji_value = e.target.getZoom();
        //alert(e.point.lng + "," + e.point.lat);
        var a = document.getElementById("aa");
        a.innerHTML = "经度：" + jing_du_value + "丨" + "纬度：" + wei_du_value + "丨" + "放大层级：" + cengji_value;
    });
    map.addEventListener("moving", function (e) {
        const { lng, lat } = map.getCenter();
        var C_jing_du_value = lng;
        var C_wei_du_value = lat;
        //alert(e.point.lng + "," + e.point.lat);
        var c = document.getElementById("cc");
        c.innerHTML = "地图中心经度：" + C_jing_du_value + "丨" + "地图中心纬度：" + C_wei_du_value;
    });

    function a() {
        this.defaultAnchor = BMAP_ANCHOR_BOTTOM_RIGHT;
        this.defaultOffset = new BMap.Size(635, 16);
    }
    a.prototype = new BMap.Control();
    a.prototype.initialize = function (map) {
        var div = document.createElement("div");
        div.id = "aa"
        div.innerText = "经度：119.590546丨纬度：25.880033丨放大层级：11"
        div.style.width = "350px";
        map.getContainer().appendChild(div);
        return div;
    };
    var myZoomCtrl = new a();
    map.addControl(myZoomCtrl);
    //开源API工具控件
    function c() {
        this.defaultAnchor = BMAP_ANCHOR_BOTTOM_RIGHT;
        this.defaultOffset = new BMap.Size(635, 0);
    }
    c.prototype = new BMap.Control();
    c.prototype.initialize = function (map) {
        var div = document.createElement("div");
        div.id = "cc"
        div.style.width = "350px";
        div.innerText = "地图中心经度：119.41347丨地图中心纬度：26.14965"
        map.getContainer().appendChild(div);
        return div;
    };
    var myZoomCtrl = new c();
    map.addControl(myZoomCtrl);
    //开源API工具控件

    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/php/users.php", true);
    xhr.onload = function () {
        var users = JSON.parse(this.responseText);//拿数据

        var htmlstr = "";
        var quyu = ["鼓楼区", "台江区", "仓山区", "晋安区", "马尾区", "长乐区", "闽侯县", "连江县", "罗源县", "闽清县", "永泰县", "福清市"];
        htmlstr += `<table class="table table-hover" border="1px solid gray">
    <thead>
        <tr>
            <th style="text-align: center;">行政区</th>
            <th style="text-align: center;">操作</th>
        </tr>
    </thead><tbody><tr>
        <td style="padding: 1.95%;vertical-align: middle;text-align:center;">福州市</td>
        <td style="padding: 1.95%;text-align:center;"><div class="btn-group">
	<button type="button" class="btn btn-primary dropdown-toggle btn-sm" 
			data-toggle="dropdown">
		操作 <span class="caret"></span>
	</button>
	<ul class="dropdown-menu" role="menu" style="min-width:10%">
		<li><a onclick="DW(this)">定位</a></li>
        <li class="divider"></li>
		<li><a onclick="CX(this)">查询</a></li>
        <li class="divider"></li>
		<li><a onclick="FZ_TJ(this)">统计</a></li>
	</ul>
</div></td>
    </tr>`;
        for (i = 0; i <= quyu.length - 1; i++) {
            htmlstr += `<tr>
        <td style="padding: 1.95%;vertical-align: middle;text-align:center;">${quyu[i]}</td>
        <td style="padding: 1.95%;text-align:center;"><div class="btn-group">
	<button type="button" class="btn btn-primary dropdown-toggle btn-sm" 
			data-toggle="dropdown">
		操作 <span class="caret"></span>
	</button>
	<ul class="dropdown-menu" role="menu" style="min-width:10%">
		<li><a onclick="DW(this)">定位</a></li>
        <li class="divider"></li>
		<li><a onclick="CX(this)">查询</a></li>
        <li class="divider"></li>
		<li><a onclick="TJ(this)">统计</a></li>
	</ul>
</div></td>
    </tr>`;
        }
        htmlstr += `</tbody></table>`;
        document.getElementById("tab").innerHTML = htmlstr

        function x5() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(15, 55);
        }
        x5.prototype = new BMap.Control();
        x5.prototype.initialize = function (map) {
            var div = document.createElement("div");
            div.id = "x1"
            map.getContainer().appendChild(div);
            return div;
        };
        var myZoomCtrl = new x5();
        map.addControl(myZoomCtrl);
        //开源API工具控件

        function x11() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT;
            this.defaultOffset = new BMap.Size(50, 15);
        }
        x11.prototype = new BMap.Control();
        x11.prototype.initialize = function (map) {
            var e2 = document.createElement("input");
            e2.id = "txt";
            e2.placeholder = "请输入查询内容";
            e2.style.width = "200px";
            e2.className = "form-control";
            map.getContainer().appendChild(e2);
            //返回DOM
            return e2;
        };
        var myZoomCtrl = new x11();
        map.addControl(myZoomCtrl);

        function msg() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT;
            this.defaultOffset = new BMap.Size(50, 50);
        }
        msg.prototype = new BMap.Control();
        msg.prototype.initialize = function (map) {
            var e2 = document.createElement("div");
            e2.id = "msg";
            e2.style.background = "white";
            e2.style.position = "absolute";
            e2.style.width = "200px";
            e2.style.borderRadius = "5px";
            e2.style.padding = "5px 10px 5px 10px";
            e2.style.border = "1px solid gray";
            e2.style.display = "none";
            map.getContainer().appendChild(e2);
            //返回DOM
            return e2;
        };
        var myZoomCtrl = new msg();
        map.addControl(myZoomCtrl);

        function x12() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT;
            this.defaultOffset = new BMap.Size(25, 25);
        }
        x12.prototype = new BMap.Control();
        x12.prototype.initialize = function (map) {
            var e2 = document.createElement("a");
            e2.id = "x12";
            e2.className = "glyphicon glyphicon-search"
            e2.href = "javascript:void(0)"
            e2.style.textDecoration = "none"
            e2.style.fontSize="15px"
            e2.style.color="black"
            e2.onclick = function () {
                var name = document.getElementById('txt').value;
                var xposition = arrayLookup(users, 'name', name, 'xposition')
                var yposition = arrayLookup(users, 'name', name, 'yposition')
                var img1 = arrayLookup(users, 'name', name, 'img1')
                var address = arrayLookup(users, 'name', name, 'address')
                var type = arrayLookup(users, 'name', name, 'type')
                var grade = arrayLookup(users, 'name', name, 'grade')
                var located = arrayLookup(users, 'name', name, 'located')
                var buildtime = arrayLookup(users, 'name', name, 'buildtime')
                var xiangxi = arrayLookup(users, 'name', name, 'xiangxi')
                var content = '<div class="div2"><div id="' + name + '" class="carousel slide" style="width: 200px;height: 130px;">' +
                    '<ol class="carousel-indicators" style="height: 0px">' +
                    '<li data-target="#' + name + '" data-slide-to="0" class="active"></li>' +
                    '<li data-target="#' + name + '" data-slide-to="1"></li>' +
                    '<li data-target="#' + name + '" data-slide-to="2"></li></ol><div class="carousel-inner" id="pic"><div class="item active">' +
                    '<img src=' + img1 + ' alt="First slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第一张</div></div><div class="item">' +
                    '<img src=' + img1 + ' alt="Second slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第二张</div></div><div class="item">' +
                    '<img src=' + img1 + ' alt="Third slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第三张</div></div></div>' +
                    '<a class="left carousel-control" style="background:transparent;" href="#' + name + '" role="button" data-slide="prev">' +
                    '<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>' +
                    '<span class="sr-only">Previous</span></a>' +
                    '<a class="right carousel-control" style="background:transparent;" href="#' + name + '" role="button" data-slide="next">' +
                    '<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>' +
                    '<span class="sr-only">Next</span>' +
                    '</a><div style="background-color: aliceblue;margin-top: 15px;border-radius: 10px;">' +
                    '<div class="p1"><a >' + name + '</a></div><div class="p2">' +
                    '<span class="p">地址：' + address + '</span><br>' +
                    '<span class="p">类别：' + type + '</span><br>' +
                    '<span class="p">保护等级：' + grade + '</span><br>' +
                    '<span class="p">所在地：' + located + '</span><br>' +
                    '<span class="p">建造年代：' + buildtime + '</span><br>' +
                    '<a id="button2" type="button" class="btn btn-primary" onclick= swal("' + name + '","' + xiangxi + '")>详情</a>'
                '</div></div></div></div>'
                var opts = {
                    enableAutoPan: true, // 是否开启信息窗口打开时地图自动移动，本应开启，但API v3.0 此功能有问题,后面在打开信息窗口内重写这种效果
                };
                var point = new BMap.Point(xposition, yposition);
                var infoWindow = new BMap.InfoWindow(content, opts); // 创建信息窗口对象
                map.openInfoWindow(infoWindow, point); //开启信息窗口
            }
            map.getContainer().appendChild(e2);
            //返回DOM
            return e2;
        };
        var myZoomCtrl = new x12();
        map.addControl(myZoomCtrl);

        DW = function (obj) {
            var x = $(obj).parent().parent().parent().parent().parent().find("td");
            var qy = x.eq(0).text()//获取行政区
            if (qy == "鼓楼区") qy = "福州鼓楼区"//修改百度行政区BUG
            document.getElementById("x1").innerHTML = ""
            var bdary = new BMap.Boundary();
            var b = qy
            bdary.get(b, function (rs) {       //获取行政区域
                map.clearOverlays();        //清除地图覆盖物       
                var count = rs.boundaries.length; //行政区域的点有多少个
                if (count === 0) {
                    alert('未能获取当前输入行政区域');
                    return;
                }
                var pointArray = [];
                for (var i = 0; i < count; i++) {
                    var ply = new BMap.Polygon(rs.boundaries[i], { strokeWeight: 2, strokeColor: "#ff0000" }); //建立多边形覆盖物
                    map.addOverlay(ply);  //添加覆盖物
                    pointArray = pointArray.concat(ply.getPath());
                }
                map.setViewport(pointArray);    //调整视野  
            });
        }

        CX = function (obj) {
            var x = $(obj).parent().parent().parent().parent().parent().find("td");
            var qy = x.eq(0).text()//获取行政区
            if (qy == "鼓楼区") qy = "福州鼓楼区"//修改百度行政区BUG
            $("#x1").show();
            document.getElementById("x1").style.height = "auto"
            document.getElementById("x1").style.overflow = "hidden"
            var bdary = new BMap.Boundary();
            var c = qy
            bdary.get(c, function (rs) {       //获取行政区域
                map.clearOverlays();        //清除地图覆盖物       
                var count = rs.boundaries.length; //行政区域的点有多少个
                if (count === 0) {
                    alert('未能获取当前输入行政区域');
                    return;
                }
                var pointArray = [];
                document.getElementById("x1").innerHTML = ""

                for (var i = 0; i < count; i++) {
                    var ply1 = new BMap.Polygon(rs.boundaries[i], { strokeWeight: 2, strokeColor: "#ff0000" }); //建立多边形覆盖物
                    for (var y in users) {
                        var result = BMapLib.GeoUtils.isPointInPolygon(new BMap.Point(users[y].xposition, users[y].yposition), ply1);
                        if (result == true) {
                            document.getElementById("x1").style.border = "1px solid gray"
                            document.getElementById("x1").innerHTML += `<div style="height: 77px;width: 220px;padding:2.5% 0 2.5% 0;background: white;white-space:normal;word-break:break-all;word-wrap:break-word;">
                               <img src="${users[y].img1}" style="height: 100%;width: 40%;float: left;margin-left: 5%;"></img>
                               <div style="padding-left:2px;padding-top:2px;height: 100%;width: 50%;background: aliceblue;float: left;line-height: 1.2;"><a style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size: 7px;" href="javascript:void(0)" onclick= sk2(${users[y].xposition},${users[y].yposition},"${users[y].img1}","${users[y].name}","${users[y].address}","${users[y].type}","${users[y].grade}","${users[y].located}","${users[y].buildtime}","${users[y].xiangxi}") >${users[y].name}</a><span style="font-size: 7px;">类型：${users[y].type}</span><br><span style="font-size: 7px;">保护等级：${users[y].grade}</span><br><span style="font-size: 7px;">建造年代：${users[y].buildtime}</span></div>
                               </div>`
                        } else {
                            document.getElementById("x1").innerHTML += ""
                        }
                    }
                    if ($("#x1").height() > 430) {
                        document.getElementById("x1").style.height = "430px"
                        document.getElementById("x1").style.overflow = "scroll"
                    }
                    map.addOverlay(ply1);  //添加覆盖物
                    pointArray = pointArray.concat(ply1.getPath());
                }
                map.setViewport(pointArray);    //调整视野  
            });
        }
        sk = function (name) {
            document.getElementById('txt').value = name;
            $("#x1").hide();
            $("#msg").hide()
        }

        sk2 = function (xposition, yposition, img1, name, address, type, grade, located, buildtime, xiangxi) {
            document.getElementById('txt').value = name;
            $("#x1").hide();
            $("#msg").hide()
            var content = '<div class="div2"><div id="' + name + '" class="carousel slide" style="width: 200px;height: 130px;">' +
                '<ol class="carousel-indicators" style="height: 0px">' +
                '<li data-target="#' + name + '" data-slide-to="0" class="active"></li>' +
                '<li data-target="#' + name + '" data-slide-to="1"></li>' +
                '<li data-target="#' + name + '" data-slide-to="2"></li></ol><div class="carousel-inner" id="pic"><div class="item active">' +
                '<img src=' + img1 + ' alt="First slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第一张</div></div><div class="item">' +
                '<img src=' + img1 + ' alt="Second slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第二张</div></div><div class="item">' +
                '<img src=' + img1 + ' alt="Third slide" style="width: 200px;height: 130px;"><div class="carousel-caption" style="width: 120px;height: 0px;">第三张</div></div></div>' +
                '<a class="left carousel-control" style="background:transparent;" href="#' + name + '" role="button" data-slide="prev">' +
                '<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>' +
                '<span class="sr-only">Previous</span></a>' +
                '<a class="right carousel-control" style="background:transparent;" href="#' + name + '" role="button" data-slide="next">' +
                '<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>' +
                '<span class="sr-only">Next</span>' +
                '</a><div style="background-color: aliceblue;margin-top: 15px;border-radius: 10px;">' +
                '<div class="p1"><a >' + name + '</a></div><div class="p2">' +
                '<span class="p">地址：' + address + '</span><br>' +
                '<span class="p">类别：' + type + '</span><br>' +
                '<span class="p">保护等级：' + grade + '</span><br>' +
                '<span class="p">所在地：' + located + '</span><br>' +
                '<span class="p">建造年代：' + buildtime + '</span><br>' +
                '<a id="button2" type="button" class="btn btn-primary" onclick= swal("' + name + '","' + xiangxi + '")>详情</a>'
            '</div></div></div></div>'

            var opts = {
                enableAutoPan: true, // 是否开启信息窗口打开时地图自动移动，本应开启，但API v3.0 此功能有问题,后面在打开信息窗口内重写这种效果
            };
            var point = new BMap.Point(xposition, yposition);
            var infoWindow = new BMap.InfoWindow(content, opts); // 创建信息窗口对象
            map.openInfoWindow(infoWindow, point); //开启信息窗口
        }

        function handle() {
            var word = document.getElementById('txt').value;
            var value = "";
            for (var i in users) {
                if (word != "" && users[i].name.match(word + ".*") != null) {
                    $("#msg").show()
                    value += `<a href="javascript:void(0)" onclick=sk("${users[i].name}")>${users[i].name}</a><br/>`
                }
                if (word == "") {
                    $("#msg").hide()
                }
            }
            document.getElementById('msg').innerHTML = value;
        }

        //firefox下检测状态改变只能用oninput,且需要用addEventListener来注册事件。   
        if (/msie/i.test(navigator.userAgent)) //ie浏览器   
        {
            document.getElementById('txt').onpropertychange = handle
        } else { //非ie浏览器，比如Firefox  
            document.getElementById('txt').addEventListener("input", handle, false);
        }

        FZ_TJ = function (obj) {
            var x = $(obj).parent().parent().parent().parent().parent().find("td");
            swal({
                title: "福州市古厝信息统计分析",
                text: `<div class="dropdown"><a type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
                        统计类型<span class="caret"></span></a>
	<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" >
		<li role="presentation" >
			<a role="menuitem" tabindex="-1" onclick=cd_located()>辖区统计</a>
		</li>
        <li role="presentation" class="divider"></li>
		<li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_type()>类别统计</a>
		</li>
        <li role="presentation" class="divider"></li>
		<li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_grade()>保护等级统计</a>
		</li>
        <li role="presentation" class="divider"></li>
        <li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_buildtime()>建造年代统计</a>
		</li>
	</ul>
</div><div id="located"><div id='located_bar' style='height:20em;width:33em;float:left'></div><div id='located_pie' style='height:20em;width:33em;float:left'></div></div>
      <div id="type" style="display:none;"><div id='type_bar' style='height:20em;width:33em;float:left'></div><div id='type_pie' style='height:20em;width:33em;float:left'></div></div>
      <div id="grade" style="display:none;"><div id='grade_bar' style='height:20em;width:33em;float:left'></div><div id='grade_pie' style='height:20em;width:33em;float:left'></div></div>
      <div id="buildtime" style="display:none;"><div id='buildtime_bar' style='height:20em;width:33em;float:left'></div><div id='buildtime_pie' style='height:20em;width:33em;float:left;'></div></div>`,
                html: true,
                customClass: "sweetAlert"
            });
            cd_located = function () {
                document.getElementById("located").style.display = ""
                document.getElementById("type").style.display = "none"
                document.getElementById("grade").style.display = "none"
                document.getElementById("buildtime").style.display = "none"
            }
            cd_type = function () {
                document.getElementById("located").style.display = "none"
                document.getElementById("type").style.display = ""
                document.getElementById("grade").style.display = "none"
                document.getElementById("buildtime").style.display = "none"
            }
            cd_grade = function () {
                document.getElementById("located").style.display = "none"
                document.getElementById("type").style.display = "none"
                document.getElementById("grade").style.display = ""
                document.getElementById("buildtime").style.display = "none"
            }
            cd_buildtime = function () {
                document.getElementById("located").style.display = "none"
                document.getElementById("type").style.display = "none"
                document.getElementById("grade").style.display = "none"
                document.getElementById("buildtime").style.display = ""
            }


            var located0 = []
            for (var i in users) {
                located0[i] = users[i].located
            }
            var located = []
            located = delRepeat(located0)
            var located_count = []
            for (i = 0; i < located.length; i++) {
                located_count[i] = 0
                for (y in users) {
                    if (users[y].located == located[i])
                        located_count[i]++;
                }
            }

            let located_result = [];
            for (let index in located) {
                located_result.push({ value: located_count[index], name: located[index] });
            }
            var located_color = []
            for (i = 0; i < located.length; i++) {
                located_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            //初始化echarts实例
            var located_bar = echarts.init(document.getElementById('located_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: located,
                        axisLabel: {
                            interval: 0
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "20px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        name: "个数",
                        type: "bar",
                        data: located_result,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = located_color
                                    return colorList[params.dataIndex]
                                },
                            },
                        },
                    }
                ]
            };
            located_bar.setOption(option);

            //初始化echarts实例
            var located_pie = echarts.init(document.getElementById('located_pie'));
            option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: located
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '辖区统计\n' + located.length + '类\n' + located0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多

                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 95 - 0.8 * located.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: located_result,//数据，数据中其他属性，查阅文档
                        color: located_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            located_pie.setOption(option);

            var type0 = []
            for (var i in users) {
                type0[i] = users[i].type
            }
            var type = []
            type = delRepeat(type0)
            var type_count = []
            for (i = 0; i < type.length; i++) {
                type_count[i] = 0
                for (y in users) {
                    if (users[y].type == type[i])
                        type_count[i]++;
                }
            }
            let type_result = [];
            for (let index in type) {
                type_result.push({ value: type_count[index], name: type[index] });
            }
            var type_color = []
            for (i = 0; i < type.length; i++) {
                type_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var type_bar = echarts.init(document.getElementById('type_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: type,
                        axisLabel: {
                            interval: 0,
                            formatter: function (value) {
                                return value.split("").join("\n");
                            }
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": type_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = type_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            type_bar.setOption(option);

            var type_pie = echarts.init(document.getElementById('type_pie'));
            option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: type
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '类型统计\n' + type.length + '类\n' + type0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 95 - 0.8 * type.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: type_result,//数据，数据中其他属性，查阅文档
                        color: type_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            type_pie.setOption(option);

            var grade0 = []
            for (var i in users) {
                grade0[i] = users[i].grade
            }
            var grade = []
            grade = delRepeat(grade0)
            var grade_count = []
            for (i = 0; i < grade.length; i++) {
                grade_count[i] = 0
                for (y in users) {
                    if (users[y].grade == grade[i])
                        grade_count[i]++;
                }
            }
            let grade_result = [];
            for (let index in grade) {
                grade_result.push({ value: grade_count[index], name: grade[index] });
            }
            var grade_color = []
            for (i = 0; i < grade.length; i++) {
                grade_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var grade_bar = echarts.init(document.getElementById('grade_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: grade,
                        axisLabel: {
                            interval: 0,
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": grade_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = grade_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            grade_bar.setOption(option);

            var grade_pie = echarts.init(document.getElementById('grade_pie'));
            option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: grade
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '保护等级统计\n' + grade.length + '类\n' + grade0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 95 - 0.8 * grade.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: grade_result,//数据，数据中其他属性，查阅文档
                        color: grade_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            grade_pie.setOption(option);

            var buildtime0 = []
            for (var i in users) {
                buildtime0[i] = users[i].buildtime
            }
            var buildtime = []
            buildtime = delRepeat(buildtime0)
            var buildtime_count = []
            for (i = 0; i < buildtime.length; i++) {
                buildtime_count[i] = 0
                for (y in users) {
                    if (users[y].buildtime == buildtime[i])
                        buildtime_count[i]++;
                }
            }
            let buildtime_result = [];
            for (let index in buildtime) {
                buildtime_result.push({ value: buildtime_count[index], name: buildtime[index] });
            }
            var buildtime_color = []
            for (i = 0; i < buildtime.length; i++) {
                buildtime_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var buildtime_bar = echarts.init(document.getElementById('buildtime_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: buildtime,
                        axisLabel: {
                            interval: 0,
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": buildtime_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = buildtime_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            buildtime_bar.setOption(option);

            var buildtime_pie = echarts.init(document.getElementById('buildtime_pie'));
            option = {
                grid: {
                    x: '1%',
                    y: '1%',
                    containLabel: true
                },
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: buildtime
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '建造年代统计\n' + buildtime.length + '类\n' + buildtime0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 90 - 0.8 * buildtime.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: buildtime_result,//数据，数据中其他属性，查阅文档
                        color: buildtime_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            buildtime_pie.setOption(option);
        }

        TJ = function (obj) {
            var x = $(obj).parent().parent().parent().parent().parent().find("td");
            var qy = x.eq(0).text()//获取行政区
            var z = x.children('select').val()//获取统计指标
            swal({
                title: qy + "古厝信息统计分析",
                text: `<div class="dropdown"><a type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
                        统计类型<span class="caret"></span></a>
	<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" >
		<li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_type()>类别统计</a>
		</li>
        <li role="presentation" class="divider"></li>
		<li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_grade()>保护等级统计</a>
		</li>
        <li role="presentation" class="divider"></li>
        <li role="presentation">
			<a role="menuitem" tabindex="-1" onclick=cd_buildtime()>建造年代统计</a>
		</li>
	</ul>
</div><div id="type";"><div id='type_bar' style='height:20em;width:33em;float:left'></div><div id='type_pie' style='height:20em;width:33em;float:left'></div></div>
      <div id="grade" style="display:none;"><div id='grade_bar' style='height:20em;width:33em;float:left'></div><div id='grade_pie' style='height:20em;width:33em;float:left'></div></div>
      <div id="buildtime" style="display:none;"><div id='buildtime_bar' style='height:20em;width:33em;float:left'></div><div id='buildtime_pie' style='height:20em;width:33em;float:left;'></div></div>`,
                html: true,
                customClass: "sweetAlert"
            });
            cd_type = function () {
                document.getElementById("type").style.display = ""
                document.getElementById("grade").style.display = "none"
                document.getElementById("buildtime").style.display = "none"
            }
            cd_grade = function () {
                document.getElementById("type").style.display = "none"
                document.getElementById("grade").style.display = ""
                document.getElementById("buildtime").style.display = "none"
            }
            cd_buildtime = function () {
                document.getElementById("type").style.display = "none"
                document.getElementById("grade").style.display = "none"
                document.getElementById("buildtime").style.display = ""
            }

            var type00 = []
            for (var i in users) {
                if (users[i].located == qy)
                    type00[i] = users[i].type
                else
                    type00[i] = null
            };
            var type0 = removeEmptyEle(type00);
            var type = []
            type = delRepeat(type0)
            var type_count = []
            for (i = 0; i < type.length; i++) {
                type_count[i] = 0
                for (y = 0; y < type0.length; y++) {
                    if (type0[y] == type[i])
                        type_count[i]++;
                }
            }
            let type_result = [];
            for (let index in type) {
                type_result.push({ value: type_count[index], name: type[index] });
            }
            var type_color = []
            for (i = 0; i < type.length; i++) {
                type_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var type_bar = echarts.init(document.getElementById('type_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: type,
                        axisLabel: {
                            interval: 0,
                            formatter: function (value) {
                                return value.split("").join("\n");
                            }
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": type_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = type_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            type_bar.setOption(option);

            var type_pie = echarts.init(document.getElementById('type_pie'));
            option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: type
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '类别统计\n' + type.length + '类\n' + type0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '类别统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 95 - 0.8 * type.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: type_result,//数据，数据中其他属性，查阅文档
                        color: type_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            type_pie.setOption(option);

            var grade00 = []
            for (var i in users) {
                if (users[i].located == qy)
                    grade00[i] = users[i].grade
                else
                    grade00[i] = null
            };
            var grade0 = removeEmptyEle(grade00);
            var grade = []
            grade = delRepeat(grade0)
            var grade_count = []
            for (i = 0; i < grade.length; i++) {
                grade_count[i] = 0
                for (y = 0; y < grade0.length; y++) {
                    if (grade0[y] == grade[i])
                        grade_count[i]++;
                }
            }
            let grade_result = [];
            for (let index in grade) {
                grade_result.push({ value: grade_count[index], name: grade[index] });
            }
            var grade_color = []
            for (i = 0; i < grade.length; i++) {
                grade_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var grade_bar = echarts.init(document.getElementById('grade_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: grade,
                        axisLabel: {
                            interval: 0,
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": grade_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = grade_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            grade_bar.setOption(option);

            var grade_pie = echarts.init(document.getElementById('grade_pie'));
            option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: grade
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '保护等级统计\n' + grade.length + '类\n' + grade0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 95 - 0.8 * grade.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: grade_result,//数据，数据中其他属性，查阅文档
                        color: grade_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            grade_pie.setOption(option);

            var buildtime00 = []
            for (var i in users) {
                if (users[i].located == qy)
                    buildtime00[i] = users[i].buildtime
                else
                    buildtime00[i] = null
            };
            var buildtime0 = removeEmptyEle(buildtime00);
            var buildtime = []
            buildtime = delRepeat(buildtime0)
            var buildtime_count = []
            for (i = 0; i < buildtime.length; i++) {
                buildtime_count[i] = 0
                for (y = 0; y < buildtime0.length; y++) {
                    if (buildtime0[y] == buildtime[i])
                        buildtime_count[i]++;
                }
            }
            let buildtime_result = [];
            for (let index in buildtime) {
                buildtime_result.push({ value: buildtime_count[index], name: buildtime[index] });
            }
            var buildtime_color = []
            for (i = 0; i < buildtime.length; i++) {
                buildtime_color[i] = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) >> 0).toString(16)).slice(-6);
            }

            var buildtime_bar = echarts.init(document.getElementById('buildtime_bar'));
            var option = {
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        dataView: { //数据视图
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    show: true,
                },
                xAxis: [
                    {
                        type: 'category',
                        data: buildtime,
                        axisLabel: {
                            interval: 0,
                        }
                    }
                ],
                grid: {
                    top: "20px",
                    left: "50px",
                    right: "15px",
                    bottom: "55px"
                },
                yAxis: [ //纵坐标
                    {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            formatter: '{value}个',//给Y轴数值添加百分号
                        },
                        axisLine: {
                            lineStyle: {
                                color: "black",//纵坐标线条颜色
                            }
                        }
                    }
                ],
                series: [
                    {
                        "name": "个数",
                        "type": "bar",
                        "data": buildtime_result,
                        "itemStyle": {
                            normal: {
                                label: {
                                    show: true,
                                    position: 'top', //柱子上方显示数值
                                    formatter: '{c}' //数值加上'个'
                                },
                                color: function (params) {
                                    // build a color map as your need.
                                    var colorList = buildtime_color;
                                    return colorList[params.dataIndex]
                                },
                            }

                        }
                    }
                ]
            };
            buildtime_bar.setOption(option);

            var buildtime_pie = echarts.init(document.getElementById('buildtime_pie'));
            option = {
                grid: {
                    x: '1%',
                    y: '1%',
                    containLabel: true
                },
                toolbox: {
                    show: true,
                    x: '10%',
                    feature: {
                        restore: { //重置
                            show: true
                        },
                        saveAsImage: {//保存图片
                            show: true
                        },
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a}<br/>{b}: {c}个 ({d}%)",
                },
                legend: {
                    type: 'scroll',
                    show: true,
                    orient: 'vertical',
                    x: 'right',
                    data: buildtime
                },//图例属性，以饼状图为例，用来说明饼状图每个扇区，data与下边series中data相匹配
                graphic: {
                    type: 'text',
                    left: 'center',
                    top: 'center',
                    style: {
                        text: '建造年代统计\n' + buildtime.length + '类\n' + buildtime0.length + '单元', //使用“+”可以使每行文字居中
                        textAlign: 'center',
                        font: 'italic bolder 16px cursive',
                        fill: '#000',
                        width: 30,
                        height: 30
                    }
                },//此例饼状图为圆环中心文字显示属性，这是一个原生图形元素组件，功能很多
                series: [
                    {
                        name: '各辖区统计',//tooltip提示框中显示内容
                        type: 'pie',//图形类型，如饼状图，柱状图等
                        radius: ['40%', 90 - 0.8 * buildtime.length + '%'],//饼图的半径，数组的第一项是内半径，第二项是外半径。支持百分比，本例设置成环形图。具体可以看文档或改变其值试一试
                        /* roseType:'area',//是否显示成南丁格尔图，默认false */
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    textStyle: { color: '#3c4858', fontSize: "12" },
                                    formatter: function (val) {   //让series 中的文字进行换行
                                        return val.name.split("-").join("\n");
                                    }
                                },//饼图图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等。可以与itemStyle属性同级，具体看文档
                                labelLine: {
                                    show: true,
                                    lineStyle: { color: '#3c4858' }
                                }//线条颜色
                            },//基本样式
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',//鼠标放在区域边框颜色
                                textColor: '#000'
                            }//鼠标放在各个区域的样式
                        },
                        data: buildtime_result,//数据，数据中其他属性，查阅文档
                        color: buildtime_color,//各个区域颜色
                    },//数组中一个{}元素，一个图，以此可以做出环形图
                ],//系列列表
            };
            buildtime_pie.setOption(option);
        };


        /* function x3() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(10, 400);
        }
        x3.prototype = new BMap.Control();
        x3.prototype.initialize = function (map) {
            var e3 = document.createElement("button");
            e3.id = "x3"
            e3.type = "button"
            e3.className = "btn btn-info"
            e3.innerHTML = "条形2";
            e3.onclick = function () {
                swal({
                    title: "",
                    text: "<div id='chartmain' style='height:400px;width:800px'></div>",
                    html: true,
                    customClass: "sweetAlert"
                });
                var quyu = ["鼓楼区", "台江区", "仓山区", "晋安区", "马尾区", "长乐区", "闽侯县", "连江县", "罗源县", "闽清县", "永泰县", "福清市"];
                count_gl = 0, count_tj = 0, count_cs = 0, count_ja = 0, count_mw = 0, count_cl = 0, count_mh = 0, count_lj = 0, count_ly = 0, count_mq = 0, count_yt = 0, count_fq = 0;
                var count = [count_gl, count_tj, count_cs, count_ja, count_mw, count_cl, count_mh, count_lj, count_ly, count_mq, count_yt, count_fq];
                for (i = 0; i < quyu.length; i++) {
                    for (y in users) {
                        if (users[y].located == quyu[i])
                            count[i]++;
                    }
                }
                var chart = echarts.init(document.getElementById('chartmain'));
                var option = {
                    tooltip: {
                        formatter: '{a}:{c}个'//a 是series中每条数据name值，c 是data数值
                    },
                    legend: {
                        orient: 'vertical', // 'horizontal'
                        data: quyu,
                        textStyle: {  // 图列内容样式
                            color: 'black',  // 字体颜色
                        },
                        x: '70%',//图例位置，设置right发现图例和文字位置反了，设置一个数值就好了
                        y: 'center'//延Y轴居中
                    },
                    grid: {
                        left: '3%',
                        right: '30%',
                        top: '3%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: [ //横坐标
                        {
                            type: 'category',
                            data: [],
                            axisLine: {
                                lineStyle: {
                                    color: "black",//横坐标线条颜色
                                }
                            }
                        }
                    ],
                    yAxis: [ //纵坐标
                        {
                            type: 'value',
                            axisLabel: {
                                show: true,
                                formatter: '{value}个',//给Y轴数值添加百分号
                            },
                            axisLine: {
                                lineStyle: {
                                    color: "black",//纵坐标线条颜色
                                }
                            }
                        }
                    ],
                    color: [
                        '#C1232B', '#B5C334', '#FCCE10', '#E87C25', '#27727B',
                        '#FE8463', '#9BCA63', '#FAD860', '#F3A43B', '#60C0DD',
                        '#D7504B', '#C6E579'
                    ],
                    series: [
                        { name: '鼓楼区' },
                        { name: '台江区' },
                        { name: '仓山区' },
                        { name: '晋安区' },
                        { name: '马尾区' },
                        { name: '长乐区' },
                        { name: '闽侯县' },
                        { name: '连江县' },
                        { name: '罗源县' },
                        { name: '闽清县' },
                        { name: '永泰县' },
                        { name: '福清市' }
                    ]
                };

                for (var i = 0; i < quyu.length; i++) {
                    var style = { //定义柱状图的样式
                        normal: {
                            label: {
                                show: true,
                                position: 'top', //柱子上方显示 数值
                                formatter: '{c}个' //数值加上'%'
                            }
                        }
                    };
                    option.series[i].type = 'bar'; //每条数据指定类型为'bar'
                    option.series[i].itemStyle = style; // series中每条数据都加的样式
                    option.series[i].data = [count[i]]; //series 中 data赋值
                };

                chart.setOption(option);

            }
            map.getContainer().appendChild(e3);
            //返回DOM
            return e3;
        } */
        /*  var myZoomCtrl = new x3(); */
        map.addControl(myZoomCtrl);
    }
    xhr.send(); 
</script>
<script>
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/php/users.php", true);
    xhr.onload = function () {
        var users = JSON.parse(this.responseText); //拿数据
        function x2() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(8, 21);
        }
        x2.prototype = new BMap.Control();
        x2.prototype.initialize = function (map) {
            var e1 = document.createElement("label");
            e1.innerHTML = "多字段查询：";
            e1.style.height = "34px";
            e1.style.color = "black";
            e1.style.fontSize = "16px"
            map.getContainer().appendChild(e1);
            //返回DOM
            return e1;
        };
        var myZoomCtrl = new x2();
        map.addControl(myZoomCtrl);

        function located() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(100, 15);
        }
        located.prototype = new BMap.Control();
        located.prototype.initialize = function (map) {
            var div = document.createElement("select");
            div.id = "located_s";
            div.style.width = "auto";
            div.className = "form-control"

            map.getContainer().appendChild(div);
            return div;
        };
        var myCtrl = new located();
        map.addControl(myCtrl);

        function grade() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(195, 15);
        }
        grade.prototype = new BMap.Control();
        grade.prototype.initialize = function (map) {
            var div = document.createElement("select");
            div.id = "grade_s";
            div.style.width = "auto";
            div.className = "form-control"

            map.getContainer().appendChild(div);
            return div;
        };
        var myCtrl = new grade();
        map.addControl(myCtrl);


        function buildtime() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(295, 15);
        }
        buildtime.prototype = new BMap.Control();
        buildtime.prototype.initialize = function (map) {
            var div = document.createElement("select");
            div.id = "buildtime_s";
            div.style.width = "auto";
            div.className = "form-control"
            map.getContainer().appendChild(div);
            return div;
        };
        var myCtrl = new buildtime();
        map.addControl(myCtrl);

        function type() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(405, 15);
        }
        type.prototype = new BMap.Control();
        type.prototype.initialize = function (map) {
            var div = document.createElement("select");
            div.id = "type_s";
            div.style.width = "auto";
            div.className = "form-control"
            map.getContainer().appendChild(div);
            return div;
        };
        var myCtrl = new type();
        map.addControl(myCtrl);

        var located_0 = []
        var grade_0 = []
        var buildtime_0 = []
        var type_0 = []
        for (var i in users) {
            located_0[i] = users[i].located
            grade_0[i] = users[i].grade
            buildtime_0[i] = users[i].buildtime
            type_0[i] = users[i].type
        }
        var located_1 = []
        var grade_1 = []
        var buildtime_1 = []
        var type_1 = []
        located_1 = delRepeat(located_0)
        grade_1 = delRepeat(grade_0)
        buildtime_1 = delRepeat(buildtime_0)
        type_1 = delRepeat(type_0)

        for (i in located_1) {
            document.getElementById("located_s").add(new Option(located_1[i], located_1[i]))
        }
        for (i in grade_1) {
            document.getElementById("grade_s").add(new Option(grade_1[i], grade_1[i]))
        }
        for (i in buildtime_1) {
            document.getElementById("buildtime_s").add(new Option(buildtime_1[i], buildtime_1[i]))
        }
        for (i in type_1) {
            document.getElementById("type_s").add(new Option(type_1[i], type_1[i]))
        }
        document.getElementById("located_s").onchange = function () {
            var select_located = document.getElementById("located_s").value
            var newdata = []
            for (i in users) {
                newdata[i] = new Array()
                newdata[i].located = select_located
                if (users[i].located == select_located) {
                    newdata[i].grade = users[i].grade
                    newdata[i].buildtime = users[i].buildtime
                    newdata[i].type = users[i].type
                }
                else {
                    newdata[i] = null
                }
            }
            var newgrade = []
            for (i = 0; i < removeEmptyEle(newdata).length; i++) {
                newgrade[i] = newdata[i].grade
            }
            console.log(delRepeat(newgrade))
            document.getElementById("grade_s").options.length = 0//清空select
            for (i = 0; i < delRepeat(newgrade).length; i++) {
                document.getElementById("grade_s").add(new Option(delRepeat(newgrade)[i], delRepeat(newgrade)[i]))
            }
        };

        document.getElementById("grade_s").onchange = function () {
            var select_located = document.getElementById("located_s").value
            var select_grade = document.getElementById("grade_s").value
            var newdata = []
            for (i in users) {
                newdata[i] = new Array()
                newdata[i].located = select_located
                newdata[i].grade = select_grade
                if (users[i].located == select_located && users[i].grade == select_grade) {
                    newdata[i].buildtime = users[i].buildtime
                    newdata[i].type = users[i].type
                }
                else {
                    newdata[i] = null
                }
            }
            var newbuildtime = []
            for (i = 0; i < removeEmptyEle(newdata).length; i++) {
                newbuildtime[i] = newdata[i].buildtime
            }
            console.log(delRepeat(newbuildtime))
            document.getElementById("buildtime_s").options.length = 0//清空select
            for (i = 0; i < delRepeat(newbuildtime).length; i++) {
                document.getElementById("buildtime_s").add(new Option(delRepeat(newbuildtime)[i], delRepeat(newbuildtime)[i]))
            }
        };

        document.getElementById("buildtime_s").onchange = function () {
            var select_located = document.getElementById("located_s").value
            var select_grade = document.getElementById("grade_s").value
            var select_buildtime = document.getElementById("buildtime_s").value
            var newdata = []
            for (i in users) {
                newdata[i] = new Array()
                newdata[i].located = select_located
                newdata[i].grade = select_grade
                newdata[i].buildtime = select_buildtime
                if (users[i].located == select_located && users[i].grade == select_grade && users[i].buildtime == select_buildtime) {
                    newdata[i].type = users[i].type
                }
                else {
                    newdata[i] = null
                }
            }
            console.log(removeEmptyEle(newdata))
            var newtype = []
            for (i = 0; i < removeEmptyEle(newdata).length; i++) {
                newtype[i] = newdata[i].type
            }
            console.log(delRepeat(newtype))
            document.getElementById("type_s").options.length = 0//清空select
            for (i = 0; i < delRepeat(newtype).length; i++) {
                document.getElementById("type_s").add(new Option(delRepeat(newtype)[i], delRepeat(newtype)[i]))
            }
        };

        function x6() {
            this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
            this.defaultOffset = new BMap.Size(520, 15);
        }
        x6.prototype = new BMap.Control();
        x6.prototype.initialize = function (map) {
            var e3 = document.createElement("button");
            e3.id = "x6"
            e3.type = "button",
                e3.className = "btn btn-info"
            e3.innerHTML = "搜索";
            e3.onclick = function () {
                $("#x1").show();
                document.getElementById("x1").style.height = "auto"
                document.getElementById("x1").style.overflow = "hidden"
                document.getElementById("x1").innerHTML = ""
                document.getElementById("x1").style.border = "1px solid gray"
                var a = document.getElementById("located_s").value
                var b = document.getElementById("grade_s").value
                var c = document.getElementById("buildtime_s").value
                var d = document.getElementById("type_s").value

                for (y in users) {
                    if (users[y].located == a && users[y].grade == b && users[y].buildtime == c && users[y].type == d) {
                        document.getElementById("x1").innerHTML += `<div style="height: 65px;width: 220px;padding:2.5% 0 2.5% 0;background: white;white-space:normal;word-break:break-all;word-wrap:break-word;">
                               <img src="${users[y].img1}" style="height: 100%;width: 40%;float: left;margin-left: 5%;"></img>
                               <div style="height: 100%;width: 50%;background: aliceblue;float: left;"><a href="javascript:void(0)" onclick= sk2(${users[y].xposition},${users[y].yposition},"${users[y].img1}","${users[y].name}","${users[y].address}","${users[y].type}","${users[y].grade}","${users[y].located}","${users[y].buildtime}","${users[y].xiangxi}") style="font-size: 9px;">${users[y].name}</a><br><span style="font-size: 9px;">${users[y].type}</span></div>
                               </div>`
                    }
                }
            }
            map.getContainer().appendChild(e3);
            //返回DOM
            return e3;
        }
        var myZoomCtrl = new x6();
        map.addControl(myZoomCtrl);
    }
    xhr.send();
</script>

</html>