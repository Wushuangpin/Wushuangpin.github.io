<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<html>

<head>
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="/leaflet/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="/leaflet/leaflet.label.css" />
	<script src="/leaflet/leaflet.js"></script>
	<script src="/js/leaflet.ChineseTmsProviders.js"></script>
	<script src="/js/leaflet.ajax.js"></script>
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="/css/second.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
	<script type="text/javascript" src="/js/sweetalert-dev.js"></script>
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<style>
		html,
		body,
		#map {
			height: 100%;
		}

		body {
			padding: 0;
			margin: 0;
		}

		.label {
			font-weight: 3000;
			text-transform: uppercase;
			text-align: center;
			margin-top: -1em;
			visibility: hidden;
			font-size: 10px;
		}
	</style>
	<title>leaflet加载天地图</title>
</head>

<body>
	<div id="map"></div>
	<script type="text/javascript">
		//地图初始化，设置中心位置及显示级别
		var map = L.map('map', {
			center: [26.03276, 119.20553],
			zoom: 16
		}
		);
		//设置天地图的电子地图数据的来源。
		var normalm = L.tileLayer.chinaProvider('TianDiTu.Normal.Map', {
			maxZoom: 18,
			minZoom: 5
		});

		var normala = L.tileLayer.chinaProvider('TianDiTu.Normal.Annotion', {
			maxZoom: 18,
			minZoom: 5
		});

		var imgm = L.tileLayer.chinaProvider('TianDiTu.Satellite.Map', {
			maxZoom: 18,
			minZoom: 5
		});

		var imga = L.tileLayer.chinaProvider('TianDiTu.Satellite.Annotion', {
			maxZoom: 18,
			minZoom: 5
		});

		//创建天地图电子地图的图层组，将电子地图与注记图层组合，形成图层组
		var normal = L.layerGroup([normalm, normala]);
		//将天地图电子地图加载到map组件上。
		map.addLayer(normal);


		//创建天地图电子地图的图层组，将电子地图与注记图层组合，形成电子地图图层组
		var normal = L.layerGroup([normalm, normala]);
		//创建天地图影像地图的图层组，将影像地图与注记图层组合，形成影像地图图层组
		var image = L.layerGroup([imgm, imga]);

		var baseLayers = {
			"地图": normal,
			"影像": image
		}
		//定义办公楼标记 

		var sd = new L.GeoJSON.AJAX('/data/data2.json', {
			style: styleFunction,
			//针对每个要素，在加载时绑定一个弹出框
			onEachFeature: function (feature, layer) {
				console.log(feature)
				console.log(layer)
				/* layer.bindPopup('<div>' + feature.properties.name + '<div><br>' + '<img src=' + feature.properties.img + ' style="width: 200px;height: 130px;">' + feature.properties.type + '<div>'); */
				layer.bindPopup('<div style="background-color: aliceblue;margin-top: 15px;border-radius: 10px;width: 200px;">' +
					'<div class="p1"><a >' + feature.properties.Name + '</a></div><div class="p2" style="padding: 5px 10px 5px 10px">' +
					'<span class="p">类型：' + feature.properties.Type + '</span><br>' +
					'<span class="p">周长：' + feature.properties.Shape_Leng + '</span><br>' +
					'<span class="p">面积：' + feature.properties.Shape_Area + '</span><br>' +
					'<span class="p">居住人数：' + feature.properties.peoplelive + '</span><br>' +
					'<span class="p">高度：' + feature.properties.Height + '</span></div></div>');

				if ((feature.properties.f != "") && (feature.properties.Type != "体育设施")) {
					var label = L.marker(layer.getBounds().getCenter(), {
						icon: L.divIcon({
							className: 'label',
							html: feature.properties.Name,
							iconSize: [5, 5]
						})
					}).addTo(map);
				}
			}
		});
		sd.addTo(map);

		//将两个图层组，组成一个对象集合。
		var myLayers = {
			"师大设施": sd,
		};

		L.control.layers(baseLayers, myLayers).addTo(map);

		map.on('zoomend', function (e) {
			if (map.getZoom() >= 17) {
				var a = document.getElementsByClassName("leaflet-marker-icon label leaflet-zoom-animated leaflet-clickable")
				for (i = 0; i < a.length; i++) {
					a[i].style.visibility = "visible";
					a[i].style.fontSize = (map.getZoom() - 16) * 7.5 + "px";
				}
			}
			else {
				var a = document.getElementsByClassName("leaflet-marker-icon label leaflet-zoom-animated leaflet-clickable")
				for (i = 0; i < a.length; i++) {
					a[i].style.visibility = "hidden";
				}
			}
		})

		/* 	map.on('click', function (e) {
				L.popup().setLatLng(e.latlng).setContent(e.latlng.toString()).openOn(map)
			}) */
		function styleFunction(feature) {
			switch (feature.properties.Height) {
				case 0:
					return {
						color: "green",
						opacity: 1,
					};
					break;
				case 1:
					return {
						color: "red",
						opacity: 1,
					};
					break;
				case 21:
					return {
						color: "red",
						opacity: 1,
					};
					break;
			}
		}
	</script>
</body>

</html>